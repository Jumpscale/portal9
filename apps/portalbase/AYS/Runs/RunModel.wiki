@usedefaults
{{timestamp}}

{{aysrun: repo:$$repo runid:$$runid reponame:$$reponame}}

{{breadcrumb:
    - Repositories : /AYS/repos
    - "Repository: $$reponame": /AYS/Repo?reponame=${reponame}
    - Runs: /AYS/Runs?reponame=$$reponame
    - Run $$runid: /AYS/Run?repo=$$repo&runid=$$runid
}}

{{cssstyle
    .table {
        position: relative;
        left: 7%;
    }
}}
{% if error is defined %}
Error : ${error}
{% else %}
h3. Run $$runid:

*Repo*: [${reponame}|/AYS/Repo?reponame=${reponame}]
{% if run['state'] in ['error'] %}
    *State*: {{html: <red style='color:red'>ERROR</red> }}
{% elif run['state'] in 'ok' %}
    *State*: {{html: <green style='color:green'>OK</green> }}
{% else %}
    *State*: ${run['state']}
{% endif -%}

*Time*: ${run.epoch}

{{html:
      <script  src='/jslib/codemirror/autorefresh.js' type='text/javascript'></script>
}}

{% if run.steps -%}
h4. Steps:
{% for step in run.steps -%}

    {{html:
        <div>
           <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#step${step.number}">+</button> <b> Step ${step.number} (${step.state})</b>
          <div id="step${step.number}" class="collapse">
     }}
        ** Jobs:
            || Actor name || Service Name || Action name ||
            {% for job in step.jobs -%}
            |[${job.actor_name}| /AYS/job?jobid=${job.key}&runid=$$runid&reponame=${reponame}]| [${job.service_name}| /AYS/service?aysname=${job.service_name}&aysrole=${job.actor_name}&reponame=${reponame}]| ${job.action_name}|
            {% endfor %}
    {{html:
        </div>
        </div>
        <br>
    }}
{% endfor -%}
{% endif %}
{% endif %}
